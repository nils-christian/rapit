pipeline {

	agent any

	environment {
		DOCKER_IMAGE = 'frekele/maven:3.5.2-jdk8'
	}
	
	stages {
		stage('Docker Pull') {
			steps {
				bat 'docker pull %DOCKER_IMAGE%'
			}
		}
		
		stage('Build') {
			steps {
				bat 'docker run -v %WORKSPACE%:/workspace -v %TEMP%/.m2:/root/.m2 -w /workspace %DOCKER_IMAGE% /bin/bash -c "mvn clean package"'
				archiveArtifacts artifacts: '**/target/rapit-*.jar', fingerprint: true
			}
		}
	}
	
	post {
		always {
			junit "**/target/surefire-reports/*.xml"
			deleteDir()
		}
	}
	
}